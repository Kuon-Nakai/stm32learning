<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM32Cube: CMSIS-Driver SPI</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="$extra_stylesheet" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1.5em;"><img alt="Logo" src="armkeil_white_h.png"/></td>
  <td style="padding-left: 1em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">STM32Cube
   &#160;<span id="projectnumber">Version 2.0</span>
   </div>
   <div id="projectbrief">Create Projects for STM32G4 Series with STM32Cube HAL and STM32CubeMX</div>
  </td>
  <!--END !PROJECT_NAME-->
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="Compnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('stm32g4_spi.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">CMSIS-Driver SPI </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="stm32g4_spi_limitations"></a>
Limitations</h1>
<p >STM32 HAL limitations:</p><ul>
<li>Number of items to send, receive or transmit is limited to 65535</li>
<li>Mode Fault and Data Lost events can be detected only when reception is active</li>
<li>Settings changes using Control function activate upon send/receive/transfer operation start</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>If SPI driver is used in IRQ mode, ensure that it has higher priority then any IRQ routine requiring longer processing time, because such IRQ routine can prevent SPI IRQ routine to correctly handle reception thus fail to receive all data correctly or fail to generate ARM_SPI_EVENT_TRANSFER_COMPLETE event. Previous limitation can also be avoided by using SPI driver in DMA mode.</dd></dl>
<h1><a class="anchor" id="stm32g4_spi_setup"></a>
STM32CubeMX Setup</h1>
<p >The CMSIS-Driver SPI requires:</p><ul>
<li>Setup of SPIx input clock</li>
<li>Setup of SPIx in Full-Duplex Master/Slave mode</li>
</ul>
<p >Valid settings for various evaluation boards are listed in the table below:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Peripheral Resource   </th><th class="markdownTableHeadLeft">NUCLEO-G474RE    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">SPI Peripheral   </td><td class="markdownTableBodyLeft"><b>SPI1</b>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">SPI Mode   </td><td class="markdownTableBodyLeft">Full-Duplex Master    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">NSS Pin   </td><td class="markdownTableBodyLeft">PA4    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">SCK Pin   </td><td class="markdownTableBodyLeft">PA5    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">MISO Pin   </td><td class="markdownTableBodyLeft">PA6    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">MOSI Pin   </td><td class="markdownTableBodyLeft">PA7   </td></tr>
</table>
<p >For different boards, refer to the hardware schematics to reflect correct setup values.</p>
<p >The STM32CubeMX configuration for NUCLEO-G474RE with steps for Pinout, Clock, and System Configuration are listed below. Enter the values that are marked <b>bold</b>.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Pinout view</h2>
<ol type="1">
<li>Configure SPI1 pins<ul>
<li>PA4: SPI1_NSS</li>
<li>PA5: SPI1_SCK</li>
<li>PA6: SPI1_MISO</li>
<li>PA7: SPI1_MOSI</li>
</ul>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md12"></a>
Pinout &amp; Configuration tab</h2>
<ol type="1">
<li>Under <em>Connectivity</em> open <b>SPI1:</b> <ul>
<li>Section <em>Mode</em><ul>
<li>Mode: <b>Full-Duplex Master</b></li>
<li>Hardware NSS Signal: <b>Hardware NSS Output Signal</b></li>
</ul>
</li>
<li>Section <em>Configuration</em><ul>
<li>Parameter Settings: not used</li>
<li>User Constants: not used</li>
<li>NVIC Settings: configured later</li>
<li>DMA Settings: configured with DMA</li>
<li>GPIO Settings: check used pins</li>
</ul>
</li>
</ul>
</li>
<li>Under <em>System Core</em> open <b>GPIO:</b> <ul>
<li><b>Group By Peripherals</b> - <b>SPI:</b> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Pin Name   </th><th class="markdownTableHeadLeft">Signal on Pin   </th><th class="markdownTableHeadLeft">GPIO mode   </th><th class="markdownTableHeadLeft">GPIO Pull-up/Pull..   </th><th class="markdownTableHeadLeft">Maximum out..   </th><th class="markdownTableHeadLeft">User Label    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">PA4   </td><td class="markdownTableBodyLeft">SPI1_NSS   </td><td class="markdownTableBodyLeft">Alternate F..   </td><td class="markdownTableBodyLeft">No pull-up and no..   </td><td class="markdownTableBodyLeft">Very High   </td><td class="markdownTableBodyLeft">.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">PA5   </td><td class="markdownTableBodyLeft">SPI1_SCK   </td><td class="markdownTableBodyLeft">Alternate F..   </td><td class="markdownTableBodyLeft">No pull-up and no..   </td><td class="markdownTableBodyLeft">Very High   </td><td class="markdownTableBodyLeft">.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">PA6   </td><td class="markdownTableBodyLeft">SPI1_MISO   </td><td class="markdownTableBodyLeft">Alternate F..   </td><td class="markdownTableBodyLeft">No pull-up and no..   </td><td class="markdownTableBodyLeft">Very High   </td><td class="markdownTableBodyLeft">.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">PA7   </td><td class="markdownTableBodyLeft">SPI1_MOSI   </td><td class="markdownTableBodyLeft">Alternate F..   </td><td class="markdownTableBodyLeft">No pull-up and no..   </td><td class="markdownTableBodyLeft">Very High   </td><td class="markdownTableBodyLeft">.   </td></tr>
</table>
</li>
</ul>
</li>
<li>Under <em>System Core</em> open <b>DMA:</b> <ul>
<li>Section <em>Configuration</em><ul>
<li><b>DMA1, DMA2</b><ul>
<li>Click on <b>Add</b> button and add requests as in table below: <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">DMA Request   </th><th class="markdownTableHeadLeft">Channel   </th><th class="markdownTableHeadLeft">Direction   </th><th class="markdownTableHeadLeft">Priority    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">SPI1_RX   </td><td class="markdownTableBodyLeft">DMA1 Channel 1   </td><td class="markdownTableBodyLeft">Peripheral to Memory   </td><td class="markdownTableBodyLeft">Low    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">SPI1_TX   </td><td class="markdownTableBodyLeft">DMA1 Channel 2   </td><td class="markdownTableBodyLeft">Memory to Peripheral   </td><td class="markdownTableBodyLeft">Low   </td></tr>
</table>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Under <em>System Core</em> open <b>NVIC:</b> <ul>
<li>Section <em>Configuration</em><ul>
<li><b>NVIC</b> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">NVIC Interrupt Table   </th><th class="markdownTableHeadLeft">Enabled   </th><th class="markdownTableHeadLeft">Preemption Priority   </th><th class="markdownTableHeadLeft">Sub Priority    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">DMA1 channel1 global interrupt   </td><td class="markdownTableBodyLeft"><b>ON</b>   </td><td class="markdownTableBodyLeft">0   </td><td class="markdownTableBodyLeft">0    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">DMA1 channel2 global interrupt   </td><td class="markdownTableBodyLeft"><b>ON</b>   </td><td class="markdownTableBodyLeft">0   </td><td class="markdownTableBodyLeft">0    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">SPI1 global interrupt   </td><td class="markdownTableBodyLeft"><b>ON</b>   </td><td class="markdownTableBodyLeft">0   </td><td class="markdownTableBodyLeft">0   </td></tr>
</table>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md13"></a>
Clock Configuration tab</h2>
<ol type="1">
<li>Configure SPI1 Clock.</li>
</ol>
<h2><a class="anchor" id="autotoc_md14"></a>
Project Manager tab</h2>
<ol type="1">
<li>Open <b>Advanced Settings</b>:<ul>
<li>enable <b>Do Not Generate Function Call</b> for MX_SPI1_Init.</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="stm32g4_spi_dv"></a>
Validation</h1>
<p >Results of the CMSIS-Driver Validation for this driver can be found in the <a href="../../../CMSIS/Driver/Validation/SPI_TestReport.txt">SPI_TestReport.txt</a> file. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
	Copyright &copy; 2015-2022 Arm Limited (or its affiliates). All rights reserved.
	<!-- Use script below for auto-inserting date, project name, version, etc  -->
	<!-- <script type="text/javascript">
        writeFooter.call(this);
    </script> -->
    </li>
  </ul>
</div>
</body>
</html>
